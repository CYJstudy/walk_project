<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/defaultLayout}">

<section layout:fragment="content" class="contents bg-warning d-flex justify-content-center">
	<div class="account-check-box">
		<h2>계정정보 찾기</h2>
			<div id="idSearchBox" class="d-none">
				<input type="text" id="emailForSearchid" class="form-control mb-2 col-12" placeholder="이메일을 입력하세요">
				<button type="button" id="idSearchBtn" class="btn btn-dark">확인</button>							
			</div>
			<div id="pwSearchBox" class="d-none">
			 	<input type="text" id="idForSearchPw" class="form-control mb-2 col-12" placeholder="아이디를 입력하세요">
				<input type="text" id="emailForSearchPw" class="form-control mb-2 col-12" placeholder="이메일을 입력하세요">
				<button type="button" id="pwSearchBtn" class="btn btn-dark">확인</button>							
			</div>
			<div th:if="${user.password != null}">
				<div id="resultPw" class="small text-danger d-none" th:value="${user.subject}"></div>
			</div>
			<div id="searchBtnBox">
				<div class="d-flex justify-content-between">
					<button type="button" id="searchId" class="btn btn-success">아이디 찾기</button>
					<button type="button" id="searchPw" class="btn btn-success">비밀번호 찾기</button>
				</div>
			</div>
			<a class="mt-2 btn btn-info col-12" href="/user/sign-in-view">로그인화면으로 돌아가기</a>			
	</div>
</section>

<th:block layout:fragment="script">
	<script>
		$(document).ready(function() {
			//alert("계정정보 찾기");
			
			// 아이디찾기
			$("#searchId").on('click', function() {
				//alert("아이디 찾기 버튼");		
				$("#idSearchBox").removeClass("d-none");
				$("#searchBtnBox").addClass("d-none");
				
				$("#idSearchBtn").on('click', function() {
					
					let email = $("#emailForSearchid").val();
					//console.log(email);
					
					if (!email) {
					alert("이메일주소를 입력하세요");
					return;
					}
					
					$.ajax({
						type:"post"
						, url:"/user/account-check-id"
						, data:{"email":email}
					
						,success:function(data) {
							if (data.code == 200) {
								alert("아이디를 확인했습니다");
							} else {
								alert(data.error_message);
							}
						}
						, error:function(error) {
							alert("아이디를 찾는데 실패했습니다.");
						}
						
					});
					
				});
				
			});
			
			// 비밀번호 찾기
			$("#searchPw").on('click', function() {
				//alert("비밀번호 찾기");
				
				$("#pwSearchBox").removeClass("d-none");
				$("#searchBtnBox").addClass("d-none");
				
				$("#pwSearchBtn").on('click', function() {
					
					let loginId = $("#idForSearchPw").val().trim();
					let email = $("#emailForSearchPw").val();
					console.log(loginId);
					console.log(email);
					
					if (!loginId) {
						alert("아이디를 입력하세요");
						return;
					}
					
					if (!email) {
					alert("이메일주소를 입력하세요");
					return;
					}

					$.ajax({
						type:"post"
						, url:"/user/account-check-pw"
						, data:{"loginId":loginId, "email":email}
					
						,success:function(data) {
							if (data.code == 200) {
								alert("비밀번호를 확인했습니다");
							} else {
								alert(data.error_message);
							}
						}
						, error:function(error) {
							alert("비밀번호를 찾는데 실패했습니다.");
						}
						
					});

				});
			});
			
		});
	</script>
</th:block>
</html>