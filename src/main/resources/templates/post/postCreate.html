<!DOCTYPE html>
<html
	xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/defaultLayout}">
	<head>
	 	<!-- jquery : bootstrap, datepicker -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>  
        
		<!-- datepicker-->
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	</head>
<section layout:fragment="content" class="mt-5 contents d-flex justify-content-center">
	<div class="post-create-box">
		<div class="d-flex justify-content-between">
			<h2>글쓰기</h2>
			<a class="btn btn-secondary" href="/post/post-list-view">글목록</a>			
		</div>
		<div></div>
		<div id="wrap" class="container">
			<div class="d-flex">
				<div class="form-control text-center">제목</div>
				<input type="text" name="subject" id="subject" class="form-control col-10">			
			</div>
			<div class="form-control text-center">산책로 정보</div>
			<div class="d-flex w-100">
				<div class="w-50 form-border">
					<img src="" alt="게시글 이미지">
				</div>
				<div class="w-50">
					<div class="d-flex">
						<div class="form-control col-3 text-center">장소</div>
						<input type="text" name="place" id="place" class="form-control col-9">
					</div>
					<div class="d-flex">
						<div class="form-control col-3 text-center">거리</div>
						<input type="text" name="distance" id="distance" class="form-control col-9">
					</div>
					<div class="d-flex">
						<div class="form-control col-3 text-center">소요시간</div>
						<input type="text" name="time" id="time" class="form-control col-9">
					</div>
					<div class="d-flex">
						<div class="form-control col-3 text-center">탐방일</div>
						<input type="text" name="visitDate" id="visitDate" class="form-control col-9">
					</div>
				</div>
			</div>
			<div class="form-control text-center">내용</div>
			<textarea rows="5" name="placeExplain" id="placeExplain" class="form-control"></textarea>
		</div>
		<div class="d-flex justify-content-end">
			<input type="file" name="file" id="file" accept=".jpg, .png, .gif">
			<button type="submit" id="savePostBtn" class="btn btn-info">저장하기</button>	
		</div>
	</div>
</section> 

<th:block layout:fragment="script">
	<script>
		$(document).ready(function() {
			//alert("게시글 저장");
			
			//datepicker
			$.datepicker.setDefaults({
				dayNamesMin: ['일', '월', '화', '수', '목', '금', '토']
				, dateFormat: 'yy-mm-dd'
			});
			
			$.datepicker._gotoToday = function(id) {
				$(id).datepicker('setDate', new Date()).datepickter('hide').blur();
			}
			
			$('#visitDate').datepicker({
				showButtonPanel: true
			});
			
			
			// 게시글 내용 저장
			$("#savePostBtn").on('click', function() {
				//alert("저장버튼");
				
				let subject = $("#subject").val().trim();
				if (subject.length < 1) {
					alert("제목을 입력해주세요");
					return;
				}
				
				let place = $("#place").val().trim();
				if (place.length < 1) {
					alert("장소를 입력해주세요");
					return;
				}
				
				let distance = $("#distance").val().trim();
				if (distance.length < 1) {
					alert("거리를 입력해주세요");
					return;
				}
				
				let time = $("#time").val().trim();
				if (time.length < 1) {
					alert("소요시간을 입력해주세요");
					return;
				}
				
				let visitDate = $("#visitDate").val();
				if (visitDate.length < 1) {
					alert("탐방일을 입력해주세요");
					return;
				}
				
				let placeExplain = $("#placeExplain").val().trim();
				if (placeExplain.length < 1) {
					alert("내용을 입력해주세요");
					return;
				}
				
				let fileName = $("#file").val();
				if (!fileName) {
					alert("이미지를 업로드해주세요");
					return;
				}
				
				if (fileName) {
					let extension = fileName.split(".").pop().toLowerCase();
					console.log(extension);
					
					if ($.inArray(extension, ["jpg", "gif", "png"]) == -1) {
						alert("이미지 파일만 업로드 할 수 있습니다.");
						$("#file").val("");  // 파일을 비운다.
						return;
					}
				}
				//console.log(subject);
				//console.log(place);
				//console.log(distance);
				//console.log(time);
				//console.log(visitDate);
				//console.log(placeExplain);
				//console.log(fileName);
				
				// 이미지 업로드 시 form태그 필요
				// key는 name과 같고, 리퀘스트 파라미터명
				let formData = new FormData();
				formData.append("subject", subject);
				formData.append("place", place);
				formData.append("distance", distance);
				formData.append("time", time);
				formData.append("visitDate", visitDate);
				formData.append("placeExplain", placeExplain);
				formData.append("file", $("#file")[0].files[0]);
				
				$.ajax({
					type:"post"
					, url:"/post/post-create"
					, data:formData
					, enctype:"multipart/form-data" // 파일 업로드 필수 설정
					, processData:false
					, contentType:false
					
					, success:function(data) {
						if (data.code == 200) {
							alert("게시글이 저장되었습니다.");
							location.href = "/post/post-list-view";
						} else {
							alert(data.error_message);
						}
					}
				, error:function(error) {
					alert("글을 저장하는데 실패했습니다.")
				}
				});
				
			});
		});
	</script>
</th:block>




















